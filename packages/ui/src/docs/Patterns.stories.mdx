import { Meta, Canvas, Story } from "@storybook/blocks";
import {
  ChatUIRoot,
  Button,
  IconButton,
  ModelSelector,
  ContextTag,
  Toggle,
  RangeSlider,
  SegmentedControl,
  CollapsibleSection,
  ListItem,
} from "../index";

<Meta title="Documentation/Component Patterns" />

# Component Patterns & Best Practices

This guide demonstrates common patterns and best practices when using ChatUI components.

## ğŸ›ï¸ Settings Panel Pattern

A common pattern for creating settings interfaces using form components:

<Canvas>
  <Story name="Settings Panel">
    {() => {
      const [darkMode, setDarkMode] = React.useState(true);
      const [volume, setVolume] = React.useState(75);
      const [quality, setQuality] = React.useState("medium");
      const [notifications, setNotifications] = React.useState(true);

      return (
        <ChatUIRoot>
          <div className="p-6 max-w-md space-y-6">
            <h2 className="text-lg font-semibold text-white">Settings</h2>

            <CollapsibleSection title="Appearance" defaultOpen>
              <div className="space-y-4">
                <div className="flex items-center justify-between">
                  <span className="text-white/80">Dark Mode</span>
                  <Toggle checked={darkMode} onChange={setDarkMode} />
                </div>

                <RangeSlider
                  label="UI Scale"
                  value={volume}
                  onChange={setVolume}
                  min={50}
                  max={150}
                  suffix="%"
                />
              </div>
            </CollapsibleSection>

            <CollapsibleSection title="Quality">
              <SegmentedControl
                value={quality}
                options={[
                  { value: "low", label: "Low" },
                  { value: "medium", label: "Medium" },
                  { value: "high", label: "High" },
                ]}
                onChange={setQuality}
              />
            </CollapsibleSection>

            <CollapsibleSection title="Notifications">
              <div className="flex items-center justify-between">
                <span className="text-white/80">Enable Notifications</span>
                <Toggle checked={notifications} onChange={setNotifications} />
              </div>
            </CollapsibleSection>
          </div>
        </ChatUIRoot>
      );
    }}

  </Story>
</Canvas>

```tsx
function SettingsPanel() {
  const [darkMode, setDarkMode] = useState(true);
  const [volume, setVolume] = useState(75);

  return (
    <div className="space-y-6">
      <CollapsibleSection title="Appearance" defaultOpen>
        <div className="flex items-center justify-between">
          <span>Dark Mode</span>
          <Toggle checked={darkMode} onChange={setDarkMode} />
        </div>

        <RangeSlider label="Volume" value={volume} onChange={setVolume} suffix="%" />
      </CollapsibleSection>
    </div>
  );
}
```

## ğŸ¯ Action Bar Pattern

Create action bars with consistent spacing and interaction patterns:

<Canvas>
  <Story name="Action Bar">
    <ChatUIRoot>
      <div className="p-4">
        <div className="flex items-center gap-2 p-3 bg-[var(--foundation-bg-dark-2)] rounded-lg">
          <IconButton icon={<span>ğŸ“‹</span>} title="Copy" variant="ghost" />
          <IconButton icon={<span>ğŸ‘</span>} title="Like" variant="ghost" />
          <IconButton icon={<span>ğŸ‘</span>} title="Dislike" variant="ghost" />
          <IconButton icon={<span>ğŸ”„</span>} title="Regenerate" variant="ghost" />

          <div className="flex-1" />

          <Button variant="outline" size="sm">
            Share
          </Button>
        </div>
      </div>
    </ChatUIRoot>

  </Story>
</Canvas>

## ğŸ“‹ List with Actions Pattern

Combine `ListItem` components with actions for navigation lists:

<Canvas>
  <Story name="List with Actions">
    <ChatUIRoot>
      <div className="p-4 max-w-sm">
        <div className="space-y-1">
          <ListItem
            icon={<span>ğŸ’¬</span>}
            active
            action={<IconButton icon={<span>â‹¯</span>} variant="ghost" size="sm" />}
          >
            <div>
              <div className="text-white font-medium">Current Chat</div>
              <div className="text-white/60 text-sm">Active conversation</div>
            </div>
          </ListItem>

          <ListItem icon={<span>ğŸ“</span>} onClick={() => console.log("New chat")}>
            Start New Chat
          </ListItem>

          <ListItem icon={<span>ğŸ“</span>} onClick={() => console.log("Browse")}>
            Browse History
          </ListItem>
        </div>
      </div>
    </ChatUIRoot>

  </Story>
</Canvas>

## ğŸ·ï¸ Tag Management Pattern

Use `ContextTag` for managing active contexts or filters:

<Canvas>
  <Story name="Tag Management">
    {() => {
      const [tags, setTags] = React.useState([
        { id: 1, label: "Work with Terminal", variant: "green" },
        { id: 2, label: "main.tsx", variant: "blue" },
        { id: 3, label: "Debug Mode", variant: "orange" },
      ]);

      const removeTag = (id) => {
        setTags(tags.filter((tag) => tag.id !== id));
      };

      return (
        <ChatUIRoot>
          <div className="p-4 space-y-3">
            <h3 className="text-white font-medium">Active Context</h3>
            <div className="flex flex-wrap gap-2">
              {tags.map((tag) => (
                <ContextTag
                  key={tag.id}
                  label={tag.label}
                  variant={tag.variant}
                  onClose={() => removeTag(tag.id)}
                />
              ))}
            </div>
            {tags.length === 0 && <p className="text-white/60 text-sm">No active context</p>}
          </div>
        </ChatUIRoot>
      );
    }}

  </Story>
</Canvas>

## ğŸ¨ Theming Best Practices

### Use Design Tokens

Always use CSS custom properties for consistent theming:

```tsx
// âœ… Good - Uses design tokens
<div className="bg-[var(--foundation-bg-dark-1)] text-[var(--foundation-text-dark-primary)]">
  Content
</div>

// âŒ Avoid - Hard-coded colors
<div className="bg-gray-900 text-white">
  Content
</div>
```

### Component Composition

Build complex interfaces by composing simple components:

```tsx
// âœ… Good - Composable
<CollapsibleSection title="Settings">
  <div className="space-y-4">
    <Toggle label="Feature A" />
    <RangeSlider label="Value B" />
  </div>
</CollapsibleSection>

// âŒ Avoid - Monolithic components
<ComplexSettingsPanel />
```

### Accessibility Patterns

Ensure proper accessibility attributes:

```tsx
// âœ… Good - Accessible
<IconButton
  icon={<CopyIcon />}
  title="Copy to clipboard"
  aria-label="Copy message to clipboard"
/>

// âŒ Missing - No accessible name
<IconButton icon={<CopyIcon />} />
```

## ğŸ“± Responsive Patterns

Components automatically adapt to different screen sizes. Use Storybook's viewport controls to test responsive behavior.

## ğŸ§ª Testing Patterns

When writing tests for your components:

1. **Use semantic queries**: `getByRole`, `getByLabelText`
2. **Test user interactions**: Click, keyboard navigation
3. **Verify accessibility**: ARIA attributes, focus management
4. **Check visual states**: Active, disabled, loading states

The A11y addon automatically validates these patterns in your stories!
